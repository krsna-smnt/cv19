{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}

<div class="container-fluid">
	<div class="row">
		<div class="col-lg-4">

			<div class="card">
			  <h1 class="card-header bg-secondary" style='text-align: center; font-weight: bolder;'>Worldwide Stats</h1>
			  <div class="card-body">
			  	<div class="container-fluid">
			  	<div class="row">

			  		<div class="col-lg-6">
			  			<div class="card">
			  				<div class="card-header" style='text-align: center;'>
					  			<h2><b>Infected</b></h2>
					  		</div>
					  		<div class="card-body" style='text-align: center;'>
					  			 <h4>{{ world.total_cases }}</h4>
					  		</div>
				  		</div>
			  		</div>

			  		<div class="col-lg-6">
			  			<div class="card">
			  				<div class="card-header" style='text-align: center;'>
					  			<h2><b>Deaths</b></h2>
					  		</div>
					  		<div class="card-body" style='text-align: center;'>
					  			 <h4>{{ world.dead }}</h4>
					  		</div>
				  		</div>
			  		</div>

			  	</div>
			  	<br>
				</div>

				<div class="container-fluid">
			  	<div class="row">

			  		<div class="col-lg-6">
			  			<div class="card">
			  				<div class="card-header" style='text-align: center;'>
					  			<h2><b>Recovered</b></h2>
					  		</div>
					  		<div class="card-body" style='text-align: center;'>
					  			 <h4>{{ world.cured }}</h4>
					  		</div>
				  		</div>
			  		</div>

			  		<div class="col-lg-6">
			  			<div class="card">
			  				<div class="card-header" style='text-align: center;'>
					  			<h2><b>Critical</b></h2>
					  		</div>
					  		<div class="card-body" style='text-align: center;'>
					  			 <h4>{{ world.critical }}</h4>
					  		</div>
				  		</div>
			  		</div>

			  	</div>
				</div>
			  </div>
			</div>

		</div>
		<div class="col-lg-8">

			<div id="chartdiv" style="width: 1200px; height: 800px;"></div>

			{% for country in countries %}
				<div class="modal fade" id="infoModal{{country.code}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle{{country.code}}" aria-hidden="true">
				  <div class="modal-dialog modal-dialog-centered" role="document">
				    <div class="modal-content">
				      <div class="modal-header">
				        <h5 class="modal-title" id="exampleModalLongTitle{{country.code}}"><b>{{ country.name }}</b></h5>
				        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				          <span aria-hidden="true">&times;</span>
				        </button>
				      </div>
				      <div class="modal-body">
				      	<ul>
							<li><b>Total Cases:</b> {{ country.total_cases }}</li>
							<li><b>Currently Infected:</b> {{ country.infected }}</li>
							<li><b>Deaths:</b> {{ country.dead }}</li>
							<li><b>Recovered:</b> {{ country.cured }}</li>
							<li><b>Critical:</b> {{ country.critical }}</li>
							<li><b>New Cases:</b> {{ country.new_infected }}</li>
							<li><b>New Deaths:</b> {{ country.new_dead }}</li>
							<li><b>Cases Per Million:</b> {{ country.cases_per_million }}</li>
							<li><b>Deaths Per Million:</b> {{ country.dead_per_million }}</li>
							<li><b>Date of First Case:</b> {{ country.first_case_date }}</li>
		        		</ul>
				      </div>
				    </div>
				  </div>
				</div>
			{% endfor %}
		</div>
	</div>
</div>

<script>

	var map = am4core.create("chartdiv", am4maps.MapChart);
	map.zoomControl = new am4maps.ZoomControl();
	map.zoomControl.slider.height = 200;
	map.panBehavior = "rotateLongLat";
	map.geodata = am4geodata_worldIndiaHigh;
	map.projection = new am4maps.projections.Orthographic();
	map.deltaLongitude = -80;
	map.deltaLatitude = -16;
	map.backgroundSeries.mapPolygons.template.polygon.fill = am4core.color("#0077be");
	map.backgroundSeries.mapPolygons.template.polygon.fillOpacity = 0.1;

	var worldSeries = map.series.push(new am4maps.MapPolygonSeries());
	worldSeries.useGeodata = true;

	// var indiaSeries = map.series.push(new am4maps.MapPolygonSeries());
	// indiaSeries.geodata = am4geodata_india2019High;
	// indiaSeries.geodataSource.url = "{% static 'assets/IND_adm3.json' %}";
	// indiaSeries.geodata = districts;

	var lst = [];
	{% for country in countries %}

		var display = "<b>{{ country.name }}</b><ul style='padding: 0'><li>Total Cases: {{ country.total_cases }}</li><li>Deaths: {{ country.dead }}</li><li>Recovered: {{ country.cured }}</li></ul><a>Click to View More</a>";
		lst.push({"id": "{{ country.code }}", "tooltipHTML": display, "fill": am4core.color("{{ country.infected_color }}")});

	{% endfor %}

	worldSeries.data = lst;

	var worldTemplate = worldSeries.mapPolygons.template;
	worldTemplate.fill = am4core.color("#bbbbbb");
	worldTemplate.propertyFields.tooltipHTML = "tooltipHTML"
	worldTemplate.propertyFields.fill = "fill";

	worldTemplate.events.on("hit", function(ev) {

		ev.target.series.chart.zoomToMapObject(ev.target);
		console.log(ev.target.dataItem.dataContext.id);
		$('#infoModal' + ev.target.dataItem.dataContext.id).modal();
	});

	// var indiaTemplate = indiaSeries.mapPolygons.template;
	// indiaTemplate.tooltipText = "{NAME_1}";

	var hs = worldTemplate.states.create("hover");
	hs.properties.fill = am4core.color("#770000");

	// var ihs = indiaTemplate.states.create("hover");
	// ihs.properties.fill = am4core.color("#ff9933");


</script>

{% endblock %}
